<html>
    <head>
        <title>Test</title>
        <!--Import von Jquery-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            setInterval(function() { 
                // alle 100 Millisekunden Status vom Server abrufen
                getSwitchStatus(); 
            }, 100);

            // Funktion für POST-Request
            function sendSwitchStatus(button){
                var url = "http://127.0.0.1:3001/setProperty";
                // JSON Objekt
                var data = {
                    "value": button.checked,
                    "id": button.id
                };
                console.log(button.checked,button.id);
                // POST-Request
                $.ajax(url, {
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    type: "POST"
                }).fail(function(data, xhr){
                    // wenn etwas failed error ausgeben
                    console.log(xhr);
                    document.getElementById("headingOne").innerHTML = "Something went wrong check console output for details";
                }).done(function(){
                    // sonst alles gut
                    document.getElementById("headingOne").innerHTML = "";
                })
                
        }
        // Funktion um per GET-Request etwas vom Backend abzurufen
        function getSwitchStatus(){
            // GET-Request senden mit Jquery
            $.get("http://127.0.0.1:3001/getButtons", function(data){
                try{
                    // JSON Objeckt parsen
                    var res = JSON.parse(data);
                    //console.log(data);
                } catch(err){
                    console.log("Error");
                }
                //console.log(res[0]);
                for(var i = 0; i < res.length; i++){
                    console.log(res[i]);
                    var object = document.getElementById(res[i].id);
                    if(res[i].value == "true" || res[i].value == "false"){
                        object.checked = res[i].value == "true";
                    } else {
                        object.innerHTML = res[i].value + " " + res[i].unit;
                    }
                    
                }
            }).fail(function(data, xhr){
                // wenn etwas failed error ausgeben
                console.log(xhr);
                document.getElementById("headingOne").innerHTML = "Something went wrong check console output for details";
            }).done(function(){
                // sonst alles gut
                document.getElementById("headingOne").innerHTML = "";
            })
        }
        </script>
    </head>
    <body onload="getSwitchStatus()">
        <!--Button Input übergibt der Funktion den Button mit this-->
        <input type="checkbox" id="buttonOne" onclick="sendSwitchStatus(this)">
        <label for="buttonOne">ButtonOne</label>
        <br>
        <h3 id="lightSensor"></h3>
        <h4 id="valueOne"></h4>
        <br>
        <!--Heading um etwas anzuzeigen-->
        <h1 id="headingOne"></h1>
    </body>